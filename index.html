<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style type="text/css">body{
margin:40px auto;
max-width:1024px;
line-height:1.6;
font-size:18px;
color:#888;
background-color:#111;
padding:0 10px
}
h1,h2,h3{line-height:1.2;text-align:center;}
a:link {color: #999;}
a:visited {color: #666;}
.two-column-grid {
    display: grid;
    grid-template-columns: 50% 50%;
}
.flex {
    display: flex;
}
input {
    width: 90%;
    margin-left: 5%;
    margin-right: 5%;
    color:#888;
    background-color:#111;
}
</style>
</head>
<body>
    <h1> Balatro </h1>

    <div class="two-column-grid" id="section-parent">
    </div>
</body>
<script>
    const sectionParent = document.getElementById("section-parent");
    
    const Err = (error) => {
        return { error }
    }
    
    const Ok = (result) => {
        return { result }
    }
    
    let sections = [
        {
            label: "Flush",
            baseChips: 35,
            baseMult: 4,
        },
        {
            label: "Straight",
            baseChips: 30,
            baseMult: 4,
        },
    ]

    const parse = (str) => {
        if (str === "") {
            return Err("No input")
        }
        
        let baseChips = []
        
        for (c of str) {
            switch (c) {
                default:
                    return Err("Unhandled char: "+ c)
                case ' ':
                    continue
                case 'A':
                case 'a':
                case '1':
                    baseChips.push(11)
                break
                case 'K':
                case 'k':
                case 'Q':
                case 'q':
                case 'J':
                case 'j':
                case 'T':
                case 't':
                    baseChips.push(10)
                break
                case '9':
                    baseChips.push(9)
                break
                case '8':
                    baseChips.push(8)
                break
                case '7':
                    baseChips.push(7)
                break
                case '6':
                    baseChips.push(6)
                break
                case '5':
                    baseChips.push(5)
                break
                case '4':
                    baseChips.push(4)
                break
                case '3':
                    baseChips.push(3)
                break
                case '2':
                    baseChips.push(2)
                break
            }
        }
        
        return Ok({
            baseChips,
        })
    }
    
    const renderSections = () => {
        for (let i = 0; i < sections.length; i += 1) {
            if (i < sectionParent.childElementCount - 1) {
                continue
            }

            const spec = sections[i]
            
            const sectionElement = document.createElement("div")
            
            const ids = {
                baseChips: `section-${i}-base-chips`,
                baseMult: `section-${i}-base-mult`,
                input: `section-${i}-input`,
                parent: `section-${i}-parent`,
            }
            
            sectionElement.innerHTML = `
                <h2> ${spec.label || "missing label"} </h2>
                
                <span class="flex">
                    <input id="${ids.baseChips}" type="number" />
                    ×
                    <input id="${ids.baseMult}" type="number" />
                </span>
                
                <input id="${ids.input}" />
                <output id="${ids.parent}" ></output>
            `
            
            sectionParent.appendChild(sectionElement)
            
            const elements = {
                baseChips: document.getElementById(ids.baseChips),
                baseMult: document.getElementById(ids.baseMult),
                input: document.getElementById(ids.input),
                parent: document.getElementById(ids.parent),
            }

            elements.baseChips.value = spec.baseChips;
            elements.baseMult.value = spec.baseMult;

            const onInput = () => {
                const parsedResult = parse(elements.input.value)

                if (parsedResult.result === undefined) {
                    elements.parent.textContent = parsedResult.error
                    return
                }
                
                const parsed = parsedResult.result

                let sum = 0
                let sumWork = ""
                let sep = ""
                for (const chips of parsed.baseChips) {
                    sum += chips

                    sumWork += sep
                    sumWork += chips
                    sep = " + "
                }

                const baseValues = { chips: parseInt(elements.baseChips.value), mult: parseInt(elements.baseMult.value) }

                elements.parent.innerHTML = `<pre>
                    (${sumWork}) = ${sum}
                    (${baseValues.chips} + ${sum}) × ${baseValues.mult} = ${(baseValues.chips + sum) * baseValues.mult}
                </pre>`
            }

            elements.baseChips.addEventListener("input", onInput)
            elements.baseMult.addEventListener("input", onInput)
            elements.input.addEventListener("input", onInput)
        }
    }
    
    renderSections()
</script>
</html>
